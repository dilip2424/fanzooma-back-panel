import { __decorate, __metadata } from "tslib";
import { AfterViewInit, Component, ElementRef, EventEmitter, Input, NgZone, OnChanges, OnDestroy, Output, Renderer2, SimpleChange, ViewChild } from '@angular/core';
import * as Plyr from 'plyr';
import { BehaviorSubject, Observable } from 'rxjs';
import { filter, first, switchMap } from 'rxjs/operators';
import { DefaultPlyrDriver } from '../plyr-driver/default-plyr-driver';
import * as Éµngcc0 from '@angular/core';

var _c0 = ["v"];
var PlyrComponent = /** @class */ (function () {
    function PlyrComponent(elementRef, ngZone, renderer) {
        this.elementRef = elementRef;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.playerChange = new BehaviorSubject(null);
        this.events = new Map();
        this.plyrType = 'video';
        // ngx-plyr events
        this.plyrInit = this.playerChange.pipe(filter(function (player) { return !!player; }));
        // standard media events
        this.plyrProgress = this.createLazyEvent('progress');
        this.plyrPlaying = this.createLazyEvent('playing');
        this.plyrPlay = this.createLazyEvent('play');
        this.plyrPause = this.createLazyEvent('pause');
        this.plyrTimeUpdate = this.createLazyEvent('timeupdate');
        this.plyrVolumeChange = this.createLazyEvent('volumechange');
        this.plyrSeeking = this.createLazyEvent('seeking');
        this.plyrSeeked = this.createLazyEvent('seeked');
        this.plyrRateChange = this.createLazyEvent('ratechange');
        this.plyrEnded = this.createLazyEvent('ended');
        this.plyrEnterFullScreen = this.createLazyEvent('enterfullscreen');
        this.plyrExitFullScreen = this.createLazyEvent('exitfullscreen');
        this.plyrCaptionsEnabled = this.createLazyEvent('captionsenabled');
        this.plyrCaptionsDisabled = this.createLazyEvent('captionsdisabled');
        this.plyrLanguageChange = this.createLazyEvent('languagechange');
        this.plyrControlsHidden = this.createLazyEvent('controlshidden');
        this.plyrControlsShown = this.createLazyEvent('controlsshown');
        this.plyrReady = this.createLazyEvent('ready');
        // HTML5 events
        this.plyrLoadStart = this.createLazyEvent('loadstart');
        this.plyrLoadedData = this.createLazyEvent('loadeddata');
        this.plyrLoadedMetadata = this.createLazyEvent('loadedmetadata');
        this.plyrQualityChange = this.createLazyEvent('qualitychange');
        this.plyrCanPlay = this.createLazyEvent('canplay');
        this.plyrCanPlayThrough = this.createLazyEvent('canplaythrough');
        this.plyrStalled = this.createLazyEvent('stalled');
        this.plyrWaiting = this.createLazyEvent('waiting');
        this.plyrEmptied = this.createLazyEvent('emptied');
        this.plyrCueChange = this.createLazyEvent('cuechange');
        this.plyrError = this.createLazyEvent('error');
        // YouTube events
        this.plyrStateChange = this.createLazyEvent('statechange');
        this.subscriptions = [];
    }
    Object.defineProperty(PlyrComponent.prototype, "player", {
        get: function () {
            return this.playerChange.getValue();
        },
        enumerable: true,
        configurable: true
    });
    PlyrComponent.prototype.ngOnChanges = function (changes) {
        var _this = this;
        this.subscriptions.push(this.plyrInit.pipe(first()).subscribe(function (player) {
            var reinitTriggers = [changes.plyrOptions, changes.plyrPlaysInline, changes.plyrCrossOrigin].filter(function (t) { return !!t; });
            if (reinitTriggers.length) {
                if (reinitTriggers.some(function (t) { return !t.firstChange; })) {
                    _this.initPlyr(true);
                }
            }
            else {
                _this.updatePlyrSource(player);
            }
        }));
    };
    PlyrComponent.prototype.ngOnDestroy = function () {
        this.destroyPlayer();
        this.subscriptions.forEach(function (s) { return s.unsubscribe(); });
    };
    PlyrComponent.prototype.ngAfterViewInit = function () {
        this.initPlyr();
    };
    PlyrComponent.prototype.initPlyr = function (force) {
        var _this = this;
        if (force === void 0) { force = false; }
        if (force || !this.player) {
            this.ngZone.runOutsideAngular(function () {
                _this.destroyPlayer();
                _this.driver = _this.plyrDriver || new DefaultPlyrDriver();
                _this.ensureVideoElement();
                var newPlayer = _this.driver.create({
                    videoElement: _this.videoElement,
                    options: _this.plyrOptions,
                });
                _this.updatePlyrSource(newPlayer);
                _this.playerChange.next(newPlayer);
            });
        }
    };
    PlyrComponent.prototype.updatePlyrSource = function (plyr) {
        this.driver.updateSource({
            videoElement: this.videoElement,
            plyr: plyr,
            source: {
                type: this.plyrType,
                title: this.plyrTitle,
                sources: this.plyrSources,
                poster: this.plyrPoster,
                tracks: this.plyrTracks,
            },
        });
    };
    // see https://stackoverflow.com/a/53704102/1990451
    PlyrComponent.prototype.createLazyEvent = function (name) {
        var _this = this;
        return this.plyrInit.pipe(switchMap(function () { return new Observable(function (observer) { return _this.on(name, function (data) { return _this.ngZone.run(function () { return observer.next(data); }); }); }); }));
    };
    PlyrComponent.prototype.destroyPlayer = function () {
        var _this = this;
        if (this.player) {
            Array.from(this.events.keys()).forEach(function (name) { return _this.off(name); });
            this.driver.destroy({
                plyr: this.player,
            });
            this.videoElement = null;
        }
    };
    Object.defineProperty(PlyrComponent.prototype, "hostElement", {
        get: function () {
            return this.elementRef.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    // this method is required because the plyr inserts clone of the original element on destroy
    // so we catch the clone element right here and reuse it
    PlyrComponent.prototype.ensureVideoElement = function () {
        var videoElement = this.hostElement.querySelector('video');
        if (videoElement) {
            this.videoElement = videoElement;
        }
        else {
            this.videoElement = this.renderer.createElement('video');
            this.videoElement.controls = true;
            if (this.plyrCrossOrigin) {
                this.videoElement.setAttribute('crossorigin', '');
            }
            if (this.plyrPlaysInline) {
                this.videoElement.setAttribute('playsinline', '');
            }
            this.renderer.appendChild(this.hostElement, this.videoElement);
        }
    };
    PlyrComponent.prototype.on = function (name, handler) {
        this.events.set(name, handler);
        this.player.on(name, handler);
    };
    PlyrComponent.prototype.off = function (name) {
        this.player.off(name, this.events.get(name));
        this.events.delete(name);
    };
    PlyrComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NgZone },
        { type: Renderer2 }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrDriver", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], PlyrComponent.prototype, "plyrType", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], PlyrComponent.prototype, "plyrTitle", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], PlyrComponent.prototype, "plyrPoster", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], PlyrComponent.prototype, "plyrSources", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], PlyrComponent.prototype, "plyrTracks", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrOptions", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], PlyrComponent.prototype, "plyrCrossOrigin", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], PlyrComponent.prototype, "plyrPlaysInline", void 0);
    __decorate([
        ViewChild('v'),
        __metadata("design:type", ElementRef)
    ], PlyrComponent.prototype, "vr", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrInit", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrProgress", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrPlaying", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrPlay", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrPause", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrTimeUpdate", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrVolumeChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrSeeking", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrSeeked", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrRateChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrEnded", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrEnterFullScreen", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrExitFullScreen", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrCaptionsEnabled", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrCaptionsDisabled", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrLanguageChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrControlsHidden", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrControlsShown", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrReady", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrLoadStart", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrLoadedData", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrLoadedMetadata", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrQualityChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrCanPlay", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrCanPlayThrough", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrStalled", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrWaiting", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrEmptied", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrCueChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrError", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PlyrComponent.prototype, "plyrStateChange", void 0);
    PlyrComponent = __decorate([ __metadata("design:paramtypes", [ElementRef,
            NgZone,
            Renderer2])
    ], PlyrComponent);
PlyrComponent.Éµfac = function PlyrComponent_Factory(t) { return new (t || PlyrComponent)(Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.ElementRef), Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.NgZone), Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.Renderer2)); };
PlyrComponent.Éµcmp = /*@__PURE__*/ Éµngcc0.ÉµÉµdefineComponent({ type: PlyrComponent, selectors: [["plyr"], ["", "plyr", ""]], viewQuery: function PlyrComponent_Query(rf, ctx) { if (rf & 1) {
        Éµngcc0.ÉµÉµviewQuery(_c0, 5);
    } if (rf & 2) {
        var _t;
        Éµngcc0.ÉµÉµqueryRefresh(_t = Éµngcc0.ÉµÉµloadQuery()) && (ctx.vr = _t.first);
    } }, inputs: { plyrType: "plyrType", plyrDriver: "plyrDriver", plyrTitle: "plyrTitle", plyrPoster: "plyrPoster", plyrSources: "plyrSources", plyrTracks: "plyrTracks", plyrOptions: "plyrOptions", plyrCrossOrigin: "plyrCrossOrigin", plyrPlaysInline: "plyrPlaysInline" }, outputs: { plyrInit: "plyrInit", plyrProgress: "plyrProgress", plyrPlaying: "plyrPlaying", plyrPlay: "plyrPlay", plyrPause: "plyrPause", plyrTimeUpdate: "plyrTimeUpdate", plyrVolumeChange: "plyrVolumeChange", plyrSeeking: "plyrSeeking", plyrSeeked: "plyrSeeked", plyrRateChange: "plyrRateChange", plyrEnded: "plyrEnded", plyrEnterFullScreen: "plyrEnterFullScreen", plyrExitFullScreen: "plyrExitFullScreen", plyrCaptionsEnabled: "plyrCaptionsEnabled", plyrCaptionsDisabled: "plyrCaptionsDisabled", plyrLanguageChange: "plyrLanguageChange", plyrControlsHidden: "plyrControlsHidden", plyrControlsShown: "plyrControlsShown", plyrReady: "plyrReady", plyrLoadStart: "plyrLoadStart", plyrLoadedData: "plyrLoadedData", plyrLoadedMetadata: "plyrLoadedMetadata", plyrQualityChange: "plyrQualityChange", plyrCanPlay: "plyrCanPlay", plyrCanPlayThrough: "plyrCanPlayThrough", plyrStalled: "plyrStalled", plyrWaiting: "plyrWaiting", plyrEmptied: "plyrEmptied", plyrCueChange: "plyrCueChange", plyrError: "plyrError", plyrStateChange: "plyrStateChange" }, exportAs: ["plyr"], features: [Éµngcc0.ÉµÉµNgOnChangesFeature], decls: 0, vars: 0, template: function PlyrComponent_Template(rf, ctx) { }, styles: [""] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && Éµngcc0.ÉµsetClassMetadata(PlyrComponent, [{
        type: Component,
        args: [{
                selector: 'plyr, [plyr]',
                template: "",
                exportAs: 'plyr',
                styles: [""]
            }]
    }], function () { return [{ type: Éµngcc0.ElementRef }, { type: Éµngcc0.NgZone }, { type: Éµngcc0.Renderer2 }]; }, { plyrType: [{
            type: Input
        }], plyrInit: [{
            type: Output
        }], plyrProgress: [{
            type: Output
        }], plyrPlaying: [{
            type: Output
        }], plyrPlay: [{
            type: Output
        }], plyrPause: [{
            type: Output
        }], plyrTimeUpdate: [{
            type: Output
        }], plyrVolumeChange: [{
            type: Output
        }], plyrSeeking: [{
            type: Output
        }], plyrSeeked: [{
            type: Output
        }], plyrRateChange: [{
            type: Output
        }], plyrEnded: [{
            type: Output
        }], plyrEnterFullScreen: [{
            type: Output
        }], plyrExitFullScreen: [{
            type: Output
        }], plyrCaptionsEnabled: [{
            type: Output
        }], plyrCaptionsDisabled: [{
            type: Output
        }], plyrLanguageChange: [{
            type: Output
        }], plyrControlsHidden: [{
            type: Output
        }], plyrControlsShown: [{
            type: Output
        }], plyrReady: [{
            type: Output
        }], plyrLoadStart: [{
            type: Output
        }], plyrLoadedData: [{
            type: Output
        }], plyrLoadedMetadata: [{
            type: Output
        }], plyrQualityChange: [{
            type: Output
        }], plyrCanPlay: [{
            type: Output
        }], plyrCanPlayThrough: [{
            type: Output
        }], plyrStalled: [{
            type: Output
        }], plyrWaiting: [{
            type: Output
        }], plyrEmptied: [{
            type: Output
        }], plyrCueChange: [{
            type: Output
        }], plyrError: [{
            type: Output
        }], plyrStateChange: [{
            type: Output
        }], plyrDriver: [{
            type: Input
        }], plyrTitle: [{
            type: Input
        }], plyrPoster: [{
            type: Input
        }], plyrSources: [{
            type: Input
        }], plyrTracks: [{
            type: Input
        }], plyrOptions: [{
            type: Input
        }], plyrCrossOrigin: [{
            type: Input
        }], plyrPlaysInline: [{
            type: Input
        }], vr: [{
            type: ViewChild,
            args: ['v']
        }] }); })();
    return PlyrComponent;
}());
export { PlyrComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx5ci5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIm5neC1wbHlyL2xpYi9wbHlyL3BseXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEssT0FBTyxLQUFLLElBQUksTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ2pFLE9BQU8sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDOzs7O0FBU3ZFO0FBQWlELElBMkUvQyx1QkFDVSxVQUFzQyxFQUN0QyxNQUFjLEVBQ2QsUUFBbUI7QUFDN0IsUUFIVSxlQUFVLEdBQVYsVUFBVSxDQUE0QjtBQUFDLFFBQ3ZDLFdBQU0sR0FBTixNQUFNLENBQVE7QUFBQyxRQUNmLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBQyxRQTVFdEIsaUJBQVksR0FBRyxJQUFJLGVBQWUsQ0FBTyxJQUFJLENBQUMsQ0FBQztBQUN6RCxRQUtVLFdBQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQzdCLFFBR1csYUFBUSxHQUFtQixPQUFPLENBQUM7QUFDOUMsUUFpQkUsa0JBQWtCO0FBQ3BCLFFBQVksYUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLE1BQU0sSUFBSSxPQUFBLENBQUMsQ0FBQyxNQUFNLEVBQVIsQ0FBUSxDQUFDLENBQXVCLENBQUM7QUFDaEcsUUFDRSx3QkFBd0I7QUFDMUIs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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQXNNRjtBQUFDLElBREQsb0JBQUM7QUFDQSxDQURBLEFBcE1ELElBb01DO0FBQ0QsU0FyTWEsYUFBYTtBQUFJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBOZ1pvbmUsIE9uQ2hhbmdlcywgT25EZXN0cm95LCBPdXRwdXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIFBseXIgZnJvbSAncGx5cic7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBmaXJzdCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRGVmYXVsdFBseXJEcml2ZXIgfSBmcm9tICcuLi9wbHlyLWRyaXZlci9kZWZhdWx0LXBseXItZHJpdmVyJztcbmltcG9ydCB7IFBseXJEcml2ZXIgfSBmcm9tICcuLi9wbHlyLWRyaXZlci9wbHlyLWRyaXZlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BseXIsIFtwbHlyXScsIC8vIHRzbGludDpkaXNhYmxlLWxpbmVcbiAgdGVtcGxhdGVVcmw6ICcuL3BseXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wbHlyLmNvbXBvbmVudC5jc3MnXSxcbiAgZXhwb3J0QXM6ICdwbHlyJ1xufSlcbmV4cG9ydCBjbGFzcyBQbHlyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuXG4gIHByaXZhdGUgcGxheWVyQ2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxQbHlyPihudWxsKTtcblxuICBnZXQgcGxheWVyKCk6IFBseXIge1xuICAgIHJldHVybiB0aGlzLnBsYXllckNoYW5nZS5nZXRWYWx1ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBldmVudHMgPSBuZXcgTWFwKCk7XG5cbiAgQElucHV0KCkgcGx5ckRyaXZlcjogUGx5ckRyaXZlcjtcblxuICBASW5wdXQoKSBwbHlyVHlwZTogUGx5ci5NZWRpYVR5cGUgPSAndmlkZW8nO1xuXG4gIEBJbnB1dCgpIHBseXJUaXRsZTogc3RyaW5nO1xuXG4gIEBJbnB1dCgpIHBseXJQb3N0ZXI6IHN0cmluZztcblxuICBASW5wdXQoKSBwbHlyU291cmNlczogUGx5ci5Tb3VyY2VbXTtcblxuICBASW5wdXQoKSBwbHlyVHJhY2tzOiBQbHlyLlRyYWNrW107XG5cbiAgQElucHV0KCkgcGx5ck9wdGlvbnM6IFBseXIuT3B0aW9ucztcblxuICBASW5wdXQoKSBwbHlyQ3Jvc3NPcmlnaW46IGJvb2xlYW47XG5cbiAgQElucHV0KCkgcGx5clBsYXlzSW5saW5lOiBib29sZWFuO1xuXG4gIEBWaWV3Q2hpbGQoJ3YnKSBwcml2YXRlIHZyOiBFbGVtZW50UmVmO1xuXG4gIC8vIG5neC1wbHlyIGV2ZW50c1xuICBAT3V0cHV0KCkgcGx5ckluaXQgPSB0aGlzLnBsYXllckNoYW5nZS5waXBlKGZpbHRlcihwbGF5ZXIgPT4gISFwbGF5ZXIpKSBhcyBFdmVudEVtaXR0ZXI8UGx5cj47XG5cbiAgLy8gc3RhbmRhcmQgbWVkaWEgZXZlbnRzXG4gIEBPdXRwdXQoKSBwbHlyUHJvZ3Jlc3MgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgncHJvZ3Jlc3MnKTtcbiAgQE91dHB1dCgpIHBseXJQbGF5aW5nID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3BsYXlpbmcnKTtcbiAgQE91dHB1dCgpIHBseXJQbGF5ID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3BsYXknKTtcbiAgQE91dHB1dCgpIHBseXJQYXVzZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdwYXVzZScpO1xuICBAT3V0cHV0KCkgcGx5clRpbWVVcGRhdGUgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgndGltZXVwZGF0ZScpO1xuICBAT3V0cHV0KCkgcGx5clZvbHVtZUNoYW5nZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCd2b2x1bWVjaGFuZ2UnKTtcbiAgQE91dHB1dCgpIHBseXJTZWVraW5nID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3NlZWtpbmcnKTtcbiAgQE91dHB1dCgpIHBseXJTZWVrZWQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnc2Vla2VkJyk7XG4gIEBPdXRwdXQoKSBwbHlyUmF0ZUNoYW5nZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdyYXRlY2hhbmdlJyk7XG4gIEBPdXRwdXQoKSBwbHlyRW5kZWQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnZW5kZWQnKTtcbiAgQE91dHB1dCgpIHBseXJFbnRlckZ1bGxTY3JlZW4gPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnZW50ZXJmdWxsc2NyZWVuJyk7XG4gIEBPdXRwdXQoKSBwbHlyRXhpdEZ1bGxTY3JlZW4gPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnZXhpdGZ1bGxzY3JlZW4nKTtcbiAgQE91dHB1dCgpIHBseXJDYXB0aW9uc0VuYWJsZWQgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnY2FwdGlvbnNlbmFibGVkJyk7XG4gIEBPdXRwdXQoKSBwbHlyQ2FwdGlvbnNEaXNhYmxlZCA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjYXB0aW9uc2Rpc2FibGVkJyk7XG4gIEBPdXRwdXQoKSBwbHlyTGFuZ3VhZ2VDaGFuZ2UgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnbGFuZ3VhZ2VjaGFuZ2UnKTtcbiAgQE91dHB1dCgpIHBseXJDb250cm9sc0hpZGRlbiA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjb250cm9sc2hpZGRlbicpO1xuICBAT3V0cHV0KCkgcGx5ckNvbnRyb2xzU2hvd24gPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnY29udHJvbHNzaG93bicpO1xuICBAT3V0cHV0KCkgcGx5clJlYWR5ID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3JlYWR5Jyk7XG5cbiAgLy8gSFRNTDUgZXZlbnRzXG4gIEBPdXRwdXQoKSBwbHlyTG9hZFN0YXJ0ID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2xvYWRzdGFydCcpO1xuICBAT3V0cHV0KCkgcGx5ckxvYWRlZERhdGEgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnbG9hZGVkZGF0YScpO1xuICBAT3V0cHV0KCkgcGx5ckxvYWRlZE1ldGFkYXRhID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2xvYWRlZG1ldGFkYXRhJyk7XG4gIEBPdXRwdXQoKSBwbHlyUXVhbGl0eUNoYW5nZSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdxdWFsaXR5Y2hhbmdlJyk7XG4gIEBPdXRwdXQoKSBwbHlyQ2FuUGxheSA9IHRoaXMuY3JlYXRlTGF6eUV2ZW50KCdjYW5wbGF5Jyk7XG4gIEBPdXRwdXQoKSBwbHlyQ2FuUGxheVRocm91Z2ggPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnY2FucGxheXRocm91Z2gnKTtcbiAgQE91dHB1dCgpIHBseXJTdGFsbGVkID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3N0YWxsZWQnKTtcbiAgQE91dHB1dCgpIHBseXJXYWl0aW5nID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3dhaXRpbmcnKTtcbiAgQE91dHB1dCgpIHBseXJFbXB0aWVkID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ2VtcHRpZWQnKTtcbiAgQE91dHB1dCgpIHBseXJDdWVDaGFuZ2UgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnY3VlY2hhbmdlJyk7XG4gIEBPdXRwdXQoKSBwbHlyRXJyb3IgPSB0aGlzLmNyZWF0ZUxhenlFdmVudCgnZXJyb3InKTtcblxuICAvLyBZb3VUdWJlIGV2ZW50c1xuICBAT3V0cHV0KCkgcGx5clN0YXRlQ2hhbmdlID0gdGhpcy5jcmVhdGVMYXp5RXZlbnQoJ3N0YXRlY2hhbmdlJyk7XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xuXG4gIHByaXZhdGUgZHJpdmVyOiBQbHlyRHJpdmVyO1xuXG4gIHByaXZhdGUgdmlkZW9FbGVtZW50OiBIVE1MVmlkZW9FbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MRGl2RWxlbWVudD4sXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSxcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogeyBbcCBpbiBrZXlvZiBQbHlyQ29tcG9uZW50XT86IFNpbXBsZUNoYW5nZTsgfSkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMucGx5ckluaXQucGlwZShmaXJzdCgpKS5zdWJzY3JpYmUoKHBsYXllcjogUGx5cikgPT4ge1xuICAgICAgY29uc3QgcmVpbml0VHJpZ2dlcnMgPSBbY2hhbmdlcy5wbHlyT3B0aW9ucywgY2hhbmdlcy5wbHlyUGxheXNJbmxpbmUsIGNoYW5nZXMucGx5ckNyb3NzT3JpZ2luXS5maWx0ZXIodCA9PiAhIXQpO1xuXG4gICAgICBpZiAocmVpbml0VHJpZ2dlcnMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChyZWluaXRUcmlnZ2Vycy5zb21lKHQgPT4gIXQuZmlyc3RDaGFuZ2UpKSB7XG4gICAgICAgICAgdGhpcy5pbml0UGx5cih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy51cGRhdGVQbHlyU291cmNlKHBsYXllcik7XG4gICAgICB9XG4gICAgfSkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kZXN0cm95UGxheWVyKCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2gocyA9PiBzLnVuc3Vic2NyaWJlKCkpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdFBseXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFBseXIoZm9yY2UgPSBmYWxzZSkge1xuICAgIGlmIChmb3JjZSB8fCAhdGhpcy5wbGF5ZXIpIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgdGhpcy5kZXN0cm95UGxheWVyKCk7XG5cbiAgICAgICAgdGhpcy5kcml2ZXIgPSB0aGlzLnBseXJEcml2ZXIgfHwgbmV3IERlZmF1bHRQbHlyRHJpdmVyKCk7XG5cbiAgICAgICAgdGhpcy5lbnN1cmVWaWRlb0VsZW1lbnQoKTtcblxuICAgICAgICBjb25zdCBuZXdQbGF5ZXIgPSB0aGlzLmRyaXZlci5jcmVhdGUoe1xuICAgICAgICAgIHZpZGVvRWxlbWVudDogdGhpcy52aWRlb0VsZW1lbnQsXG4gICAgICAgICAgb3B0aW9uczogdGhpcy5wbHlyT3B0aW9ucyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVQbHlyU291cmNlKG5ld1BsYXllcik7XG5cbiAgICAgICAgdGhpcy5wbGF5ZXJDaGFuZ2UubmV4dChuZXdQbGF5ZXIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQbHlyU291cmNlKHBseXI6IFBseXIpIHtcbiAgICB0aGlzLmRyaXZlci51cGRhdGVTb3VyY2Uoe1xuICAgICAgdmlkZW9FbGVtZW50OiB0aGlzLnZpZGVvRWxlbWVudCxcbiAgICAgIHBseXIsXG4gICAgICBzb3VyY2U6IHtcbiAgICAgICAgdHlwZTogdGhpcy5wbHlyVHlwZSxcbiAgICAgICAgdGl0bGU6IHRoaXMucGx5clRpdGxlLFxuICAgICAgICBzb3VyY2VzOiB0aGlzLnBseXJTb3VyY2VzLFxuICAgICAgICBwb3N0ZXI6IHRoaXMucGx5clBvc3RlcixcbiAgICAgICAgdHJhY2tzOiB0aGlzLnBseXJUcmFja3MsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLy8gc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS81MzcwNDEwMi8xOTkwNDUxXG4gIHByaXZhdGUgY3JlYXRlTGF6eUV2ZW50PFQgZXh0ZW5kcyBQbHlyLlBseXJFdmVudD4obmFtZTogUGx5ci5TdGFuZGFyZEV2ZW50IHwgUGx5ci5IdG1sNUV2ZW50IHwgUGx5ci5Zb3V0dWJlRXZlbnQpOiBFdmVudEVtaXR0ZXI8VD4ge1xuICAgIHJldHVybiB0aGlzLnBseXJJbml0LnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4gdGhpcy5vbihuYW1lLCAoZGF0YTogVCkgPT4gdGhpcy5uZ1pvbmUucnVuKCgpID0+IG9ic2VydmVyLm5leHQoZGF0YSkpKSkpXG4gICAgKSBhcyBFdmVudEVtaXR0ZXI8VD47XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lQbGF5ZXIoKSB7XG4gICAgaWYgKHRoaXMucGxheWVyKSB7XG4gICAgICBBcnJheS5mcm9tKHRoaXMuZXZlbnRzLmtleXMoKSkuZm9yRWFjaChuYW1lID0+IHRoaXMub2ZmKG5hbWUpKTtcblxuICAgICAgdGhpcy5kcml2ZXIuZGVzdHJveSh7XG4gICAgICAgIHBseXI6IHRoaXMucGxheWVyLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudmlkZW9FbGVtZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldCBob3N0RWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICAvLyB0aGlzIG1ldGhvZCBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBwbHlyIGluc2VydHMgY2xvbmUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQgb24gZGVzdHJveVxuICAvLyBzbyB3ZSBjYXRjaCB0aGUgY2xvbmUgZWxlbWVudCByaWdodCBoZXJlIGFuZCByZXVzZSBpdFxuICBwcml2YXRlIGVuc3VyZVZpZGVvRWxlbWVudCgpIHtcbiAgICBjb25zdCB2aWRlb0VsZW1lbnQgPSB0aGlzLmhvc3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJyk7XG5cbiAgICBpZiAodmlkZW9FbGVtZW50KSB7XG4gICAgICB0aGlzLnZpZGVvRWxlbWVudCA9IHZpZGVvRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aWRlb0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG4gICAgICB0aGlzLnZpZGVvRWxlbWVudC5jb250cm9scyA9IHRydWU7XG5cbiAgICAgIGlmICh0aGlzLnBseXJDcm9zc09yaWdpbikge1xuICAgICAgICB0aGlzLnZpZGVvRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Nyb3Nzb3JpZ2luJywgJycpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5wbHlyUGxheXNJbmxpbmUpIHtcbiAgICAgICAgdGhpcy52aWRlb0VsZW1lbnQuc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmhvc3RFbGVtZW50LCB0aGlzLnZpZGVvRWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvbihuYW1lOiBzdHJpbmcsIGhhbmRsZXI6IGFueSkge1xuICAgIHRoaXMuZXZlbnRzLnNldChuYW1lLCBoYW5kbGVyKTtcbiAgICB0aGlzLnBsYXllci5vbihuYW1lIGFzIGFueSwgaGFuZGxlcik7XG4gIH1cblxuICBwcml2YXRlIG9mZihuYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLnBsYXllci5vZmYobmFtZSBhcyBhbnksIHRoaXMuZXZlbnRzLmdldChuYW1lKSk7XG4gICAgdGhpcy5ldmVudHMuZGVsZXRlKG5hbWUpO1xuICB9XG5cbn1cbiJdfQ==