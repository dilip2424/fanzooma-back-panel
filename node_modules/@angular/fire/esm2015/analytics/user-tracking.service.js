/**
 * @fileoverview added by tsickle
 * Generated from: user-tracking.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { isPlatformServer } from '@angular/common';
import { Inject, Injectable, NgZone, PLATFORM_ID } from '@angular/core';
import { AngularFireAnalytics } from './analytics';
import { AngularFireAuth } from '@angular/fire/auth';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './analytics';
import * as ɵngcc2 from '@angular/fire/auth';
export class UserTrackingService {
    // TODO a user properties injector
    /**
     * @param {?} analytics
     * @param {?} platformId
     * @param {?} auth
     * @param {?} zone
     */
    constructor(analytics, 
    // tslint:disable-next-line:ban-types
    platformId, auth, zone) {
        this.disposables = [];
        if (!isPlatformServer(platformId)) {
            /** @type {?} */
            let resolveInitialized;
            this.initialized = zone.runOutsideAngular((/**
             * @return {?}
             */
            () => new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            resolve => resolveInitialized = resolve))));
            this.disposables = [
                auth.authState.subscribe((/**
                 * @param {?} user
                 * @return {?}
                 */
                user => {
                    analytics.setUserId(user === null || user === void 0 ? void 0 : user.uid);
                    resolveInitialized();
                })),
                auth.credential.subscribe((/**
                 * @param {?} credential
                 * @return {?}
                 */
                credential => {
                    if (credential) {
                        /** @type {?} */
                        const method = credential.user.isAnonymous ? 'anonymous' : credential.additionalUserInfo.providerId;
                        if (credential.additionalUserInfo.isNewUser) {
                            analytics.logEvent('sign_up', { method });
                        }
                        analytics.logEvent('login', { method });
                    }
                }))
            ];
        }
        else {
            this.initialized = Promise.resolve();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.disposables.forEach((/**
         * @param {?} it
         * @return {?}
         */
        it => it.unsubscribe()));
    }
}
UserTrackingService.ɵfac = function UserTrackingService_Factory(t) { return new (t || UserTrackingService)(ɵngcc0.ɵɵinject(ɵngcc1.AngularFireAnalytics), ɵngcc0.ɵɵinject(PLATFORM_ID), ɵngcc0.ɵɵinject(ɵngcc2.AngularFireAuth), ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
UserTrackingService.ɵprov = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjectable({ token: UserTrackingService, factory: UserTrackingService.ɵfac });
/** @nocollapse */
UserTrackingService.ctorParameters = () => [
    { type: AngularFireAnalytics },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
    { type: AngularFireAuth },
    { type: NgZone }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(UserTrackingService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.AngularFireAnalytics }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }, { type: ɵngcc2.AngularFireAuth }, { type: ɵngcc0.NgZone }]; }, null); })();
if (false) {
    /** @type {?} */
    UserTrackingService.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    UserTrackingService.prototype.disposables;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci10cmFja2luZy5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9ydW5uZXIvd29yay9hbmd1bGFyZmlyZS9hbmd1bGFyZmlyZS9zcmMvYW5hbHl0aWNzL3VzZXItdHJhY2tpbmcuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBYSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7OztBQUlyRCxNQUFNLE9BQU8sbUJBQW1CO0FBQUc7QUFFbEI7QUFBUTtBQUNGO0FBRXJCO0FBQXVCO0FBQ2Q7QUFDUCxJQURGLFlBQ0UsU0FBK0I7QUFDbEMsSUFBRyxxQ0FBcUM7QUFDekMsSUFBeUIsVUFBa0IsRUFDdkMsSUFBcUIsRUFDckIsSUFBWTtBQUNkLFFBVFEsZ0JBQVcsR0FBd0IsRUFBRSxDQUFDO0FBQ2hELFFBVUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ3ZDO0FBQTZCLGdCQUFuQixrQkFBa0I7QUFDNUIsWUFBTSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUI7QUFBTTtBQUEyQjtBQUFnQixZQUFoRCxHQUFHLEVBQUUsQ0FBQyxJQUFJLE9BQU87QUFBTTtBQUFrQztBQUNsRjtBQUNYLFlBRnNELE9BQU8sQ0FBQyxFQUFFLENBQUMsa0JBQWtCLEdBQUcsT0FBTyxFQUFDLEVBQUMsQ0FBQztBQUM1RyxZQUFNLElBQUksQ0FBQyxXQUFXLEdBQUc7QUFDekIsZ0JBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTO0FBQU07QUFDVjtBQUNiO0FBQ2QsZ0JBSGdDLElBQUksQ0FBQyxFQUFFO0FBQzFDLG9CQUFZLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzNDLG9CQUFZLGtCQUFrQixFQUFFLENBQUM7QUFDakMsZ0JBQVUsQ0FBQyxFQUFDO0FBQ1osZ0JBQVUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTO0FBQU07QUFFekM7QUFBK0I7QUFBb0IsZ0JBRmYsVUFBVSxDQUFDLEVBQUU7QUFDakQsb0JBQVksSUFBSSxVQUFVLEVBQUU7QUFDNUI7QUFBeUMsOEJBQXJCLE1BQU0sR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsa0JBQWtCLENBQUMsVUFBVTtBQUNqSCx3QkFBYyxJQUFJLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUU7QUFDM0QsNEJBQWdCLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUMxRCx5QkFBZTtBQUNmLHdCQUFjLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUN0RCxxQkFBYTtBQUNiLGdCQUFVLENBQUMsRUFBQztBQUNaLGFBQU8sQ0FBQztBQUNSLFNBQUs7QUFBQyxhQUFLO0FBQ1gsWUFBTSxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUMzQyxTQUFLO0FBQ0wsSUFDRSxDQUFDO0FBQ0g7QUFDTztBQUNDO0FBQVEsSUFEZCxXQUFXO0FBQ2IsUUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU87QUFBTTtBQUVqQztBQUNxQjtBQUFZLFFBSEwsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLEVBQUMsQ0FBQztBQUNyRCxJQUFFLENBQUM7QUFDSDsrQ0ExQ0MsVUFBVTt1SUFDVDtBQUFDO0FBQW1CO0FBRVosWUFQRCxvQkFBb0I7QUFBSSxZQWNJLE1BQU0sdUJBQXRDLE1BQU0sU0FBQyxXQUFXO0FBQVMsWUFidkIsZUFBZTtBQUFJLFlBRkMsTUFBTTtBQUFHOzs7Ozs7NkZBQUU7QUFBQztBQUFhO0FBQXFCLElBUXpFLDBDQUEyQjtBQUM3QjtBQUFRO0FBQWlCO0FBQWdCO0FBQ3pDLElBREUsMENBQThDO0FBQ2hEO0FBQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1BsYXRmb3JtU2VydmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgTmdab25lLCBPbkRlc3Ryb3ksIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbmd1bGFyRmlyZUFuYWx5dGljcyB9IGZyb20gJy4vYW5hbHl0aWNzJztcbmltcG9ydCB7IEFuZ3VsYXJGaXJlQXV0aCB9IGZyb20gJ0Bhbmd1bGFyL2ZpcmUvYXV0aCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFVzZXJUcmFja2luZ1NlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIGluaXRpYWxpemVkOiBQcm9taXNlPHZvaWQ+O1xuICBwcml2YXRlIGRpc3Bvc2FibGVzOiBBcnJheTxTdWJzY3JpcHRpb24+ID0gW107XG5cbiAgLy8gVE9ETyBhIHVzZXIgcHJvcGVydGllcyBpbmplY3RvclxuICBjb25zdHJ1Y3RvcihcbiAgICBhbmFseXRpY3M6IEFuZ3VsYXJGaXJlQW5hbHl0aWNzLFxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpiYW4tdHlwZXNcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwbGF0Zm9ybUlkOiBPYmplY3QsXG4gICAgYXV0aDogQW5ndWxhckZpcmVBdXRoLFxuICAgIHpvbmU6IE5nWm9uZSxcbiAgKSB7XG5cbiAgICBpZiAoIWlzUGxhdGZvcm1TZXJ2ZXIocGxhdGZvcm1JZCkpIHtcbiAgICAgIGxldCByZXNvbHZlSW5pdGlhbGl6ZWQ7XG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlc29sdmVJbml0aWFsaXplZCA9IHJlc29sdmUpKTtcbiAgICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBbXG4gICAgICAgICAgYXV0aC5hdXRoU3RhdGUuc3Vic2NyaWJlKHVzZXIgPT4ge1xuICAgICAgICAgICAgYW5hbHl0aWNzLnNldFVzZXJJZCh1c2VyPy51aWQpO1xuICAgICAgICAgICAgcmVzb2x2ZUluaXRpYWxpemVkKCk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgYXV0aC5jcmVkZW50aWFsLnN1YnNjcmliZShjcmVkZW50aWFsID0+IHtcbiAgICAgICAgICAgIGlmIChjcmVkZW50aWFsKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1ldGhvZCA9IGNyZWRlbnRpYWwudXNlci5pc0Fub255bW91cyA/ICdhbm9ueW1vdXMnIDogY3JlZGVudGlhbC5hZGRpdGlvbmFsVXNlckluZm8ucHJvdmlkZXJJZDtcbiAgICAgICAgICAgICAgaWYgKGNyZWRlbnRpYWwuYWRkaXRpb25hbFVzZXJJbmZvLmlzTmV3VXNlcikge1xuICAgICAgICAgICAgICAgIGFuYWx5dGljcy5sb2dFdmVudCgnc2lnbl91cCcsIHsgbWV0aG9kIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGFuYWx5dGljcy5sb2dFdmVudCgnbG9naW4nLCB7IG1ldGhvZCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5kaXNwb3NhYmxlcy5mb3JFYWNoKGl0ID0+IGl0LnVuc3Vic2NyaWJlKCkpO1xuICB9XG59XG4iXX0=